# –°–µ—Ä–≤–∏—Å —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** (—Å—Ç—Ä–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤).

**–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è**:
—Å–µ—Ä–≤–∏—Å **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–Ω–∞–µ—Ç –∏ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∏**, –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ.
–û–Ω –æ—Ç–≤–µ—á–∞–µ—Ç **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–∂–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ–∫—Ä–µ—Ç–æ–≤.

–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ / –∫–ª–∏–µ–Ω—Ç–∞**.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

* üîí –•—Ä–∞–Ω—è—Ç—Å—è **—Ç–æ–ª—å–∫–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
* üîë –ö–ª—é—á–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è**
* üì¶ –ü–æ–¥–¥–µ—Ä–∂–∫–∞:

  * –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
  * –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
* üßæ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
* üóëÔ∏è Soft delete –∏ –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (purge)
* üß± –ì–∞—Ä–∞–Ω—Ç–∏–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
* üß™ –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏

---


## –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ PKI –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
https://github.com/IvanShankin/ScriptsForCreatingPKI

–î–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ `Server`.


### 2. –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã **–ù–ï –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∞—Å—Ç—å—é Docker-–æ–±—Ä–∞–∑–∞**.

–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ), –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
/opt/Project/
‚îú‚îÄ‚îÄ DataStorageService/ 
‚îÇ   ‚îî‚îÄ‚îÄ .... 
‚îî‚îÄ‚îÄ certs/ 
    ‚îú‚îÄ‚îÄ ca/ 
    ‚îÇ    ‚îî‚îÄ‚îÄ server_ca_chain.pem 
    ‚îî‚îÄ‚îÄ server/ 
        ‚îú‚îÄ‚îÄ server_cert.pem 
        ‚îî‚îÄ‚îÄ server_key.pem
```

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–Ω–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∞—Å—Ç—å—é —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
Docker-–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –≤ —Ä–µ–∂–∏–º–µ read-only.
–î–∞–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç **–ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** —Å –ø–æ–º–æ—â—å—é Docker volume –≤ —Ä–µ–∂–∏–º–µ `read-only`.

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `.env` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ –ø—Ä–∏–º–µ—Ä—É `.env.example`.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:

* **CERTS_DIR** ‚Äî –ø—É—Ç—å **–Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ** –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
  (–±—É–¥–µ—Ç –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–µ—Ä–µ–∑ Docker volume)

* **SSL_CERT_FILE**, **SSL_KEY_FILE**, **SSL_CA_FILE** ‚Äî –ø—É—Ç–∏ **–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```env
CERTS_DIR=/opt/certs

SSL_CERT_FILE=/app/certs/server/server_cert.pem
SSL_KEY_FILE=/app/certs/server/server_key.pem
SSL_CA_FILE=/app/certs/ca/server_ca_chain.pem
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞—Ö

–î–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PKI —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.


### 5. –ó–∞–ø—É—Å–∫

–°–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É —á–µ—Ä–µ–∑ Docker.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
[ Client / Main Server ]
        |
        |  (encrypted payload)
        v
[ Secrets Storage Service ]
        |
        |-- PostgreSQL (metadata, versions, audit)
        |
        |-- Filesystem (encrypted files)
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ—Ä–≤–∏—Å

* —Ö—Ä–∞–Ω–∏—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
* —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ—Ä—Å–∏—è–º–∏
* –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
* –≤–µ–¥—ë—Ç –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π

### –ß—Ç–æ —Å–µ—Ä–≤–∏—Å **–ù–ï –¥–µ–ª–∞–µ—Ç**

* ‚ùå –Ω–µ —à–∏—Ñ—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
* ‚ùå –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –∫–ª—é—á–∏
* ‚ùå –Ω–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
* ‚ùå –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

---

## –¢–∏–ø—ã —Å–µ–∫—Ä–µ—Ç–æ–≤

### 1. Secret String

–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (bytes ‚Üí base64).

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:

* –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ—Ä—Å–∏–π
* –∫–∞–∂–¥–∞—è –≤–µ—Ä—Å–∏—è ‚Äî –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è
* –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –Ω–µ —É–¥–∞–ª—ë–Ω–Ω—ã–º —Å–µ–∫—Ä–µ—Ç–∞–º

### 2. Secret File

–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª.

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:

* —Ñ–∞–π–ª —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
* –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ ‚Äî –≤ –ë–î
* –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ—Ä—Å–∏–π
* —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ purge

---

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ–∫—Ä–µ—Ç–∞

1. **–°–æ–∑–¥–∞–Ω–∏–µ**

   * —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `Secrets`
   * —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–µ—Ä—Å–∏—è (v1)

2. **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏**

   * `Secrets` –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–µ–º –∂–µ
   * –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è

3. **Soft delete**

   * `is_deleted = true`
   * –¥–∞–Ω–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è
   * –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ

4. **Purge**

   * –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:

     * —Å—Ç—Ä–æ–∫–∏ ‚Äî –∏–∑ –ë–î
     * —Ñ–∞–π–ª—ã ‚Äî –∏–∑ –ë–î –∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

---

## Endpoints (–æ–±–∑–æ—Ä)


### –°—Ç—Ä–æ–∫–∏

* `POST /secrets_strings/create_string`
* `POST /secrets_strings/versions`
* `GET /secret_string/{name}/{version}`

### –§–∞–π–ª—ã

* `POST /secrets/create_files`
* `GET /secrets/files/{name}/{version}`
* `GET /secrets/files/{name}/{version}/download`

### –£–¥–∞–ª–µ–Ω–∏–µ

* `DELETE /secrets/{name}` ‚Äî soft delete
* `DELETE /secrets/{name}/purge` ‚Äî –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* —Å–µ—Ä–≤–∏—Å –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª—é—á–∞–º
* —É—Ç–µ—á–∫–∞ –ë–î –∏–ª–∏ —Ñ–∞–π–ª–æ–≤:

  * **–Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ**
* –∫–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏:

  * `sha256`
* —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* –∏–∑–æ–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

* —Å–µ—Ä–≤–∏—Å **–Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω** –¥–ª—è:

  * —Ä–∞–±–æ—Ç—ã —Å plaintext
  * –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
  * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
* –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è **–¥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–∏—Å—É**

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Python 3.12+
* FastAPI
* SQLAlchemy (async)
* PostgreSQL
* —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (–ª–æ–∫–∞–ª—å–Ω–∞—è –∏–ª–∏ volume)

---

## –¢–µ—Å—Ç—ã
–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ tests.   
–î–ª—è —Ç–µ—Å—Ç–æ–≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `tests/test_cert/create_dev_certs.bat` 
–æ–Ω —Å–æ–∑–¥–∞—Å—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `certs`, –µ–≥–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞, –≤ –Ω—ë–º —É–∂–µ –µ—Å—Ç—å –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤.    
–î–ª—è —Ç–æ–≥–æ —á—Ç–æ –±—ã –ø–æ–¥—Ä–æ–±–Ω–µ–µ –∏–∑—É—á–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å `readme –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.md`
